<!DOCTYPE html>
<html lang="zh-Hant">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>è©±é¡Œè£½é€ æ©Ÿ - èšæœƒç ´å†° RWD ç¶²ç«™</title>
   <!-- è¼‰å…¥ Tailwind CSS -->
   <script src="https://cdn.tailwindcss.com"></script>
   <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
   <style>
       /* ä½¿ç”¨ Noto Sans TC è®“ä¸­æ–‡å­—é«”é¡¯ç¤ºæ›´æ¸…æ™°ç¾è§€ */
       body {
           font-family: 'Noto Sans TC', 'Inter', sans-serif;
           background-color: #f7f9fb;
       }
       /* è‡ªè¨‚æŒ‰éˆ•æ¨£å¼ */
       .btn-primary {
           transition: all 0.2s ease-in-out;
           box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
       }
       .btn-primary:hover {
           transform: translateY(-2px);
           box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
       }
       .btn-primary:active {
           transform: translateY(0);
           box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
       }
   </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

   <!-- ä¸»æ‡‰ç”¨ç¨‹å¼å®¹å™¨ -->
   <div class="w-full max-w-4xl bg-white rounded-3xl shadow-2xl p-6 md:p-10 flex flex-col items-center">

       <h1 class="text-3xl font-bold text-gray-800 mb-2">è©±é¡Œè£½é€ æ©Ÿ ğŸ²</h1>
       <p class="text-gray-500 mb-6 text-center">å°ˆç‚ºèšæœƒè¨­è¨ˆçš„ç ´å†°èˆ‡æ·±åº¦å°è©±å·¥å…·</p>
       
       <!-- User ID Display (Static/Demo for pure frontend) -->
       <p class="text-xs text-gray-400 mb-4 self-end">
           ç‹€æ…‹: <span id="user-id-display" class="font-mono text-gray-600 font-bold">ç´”å‰ç«¯æœ¬åœ°æ¨¡å¼</span>
       </p>

       <!-- é¡åˆ¥é¸æ“‡èˆ‡é¡¯ç¤ºå€åŸŸ -->
       <div class="w-full mb-8">
           <label for="category-select" class="block text-lg font-medium text-gray-700 mb-2">
               é¸æ“‡ä¸»é¡Œï¼š
           </label>
           <select id="category-select" class="w-full p-3 border border-gray-300 rounded-xl bg-gray-50 text-gray-800 focus:ring-indigo-500 focus:border-indigo-500 shadow-sm transition duration-150">
               <!-- é¸é …å°‡ç”± JS å‹•æ…‹ç”Ÿæˆ -->
           </select>
       </div>

       <!-- å•é¡Œé¡¯ç¤ºå¡ç‰‡ -->
       <div id="question-card" class="w-full bg-indigo-500 text-white rounded-2xl p-8 text-center min-h-[250px] flex flex-col justify-center items-center shadow-lg transition duration-300 transform hover:scale-[1.01]">
           <p class="text-xl font-medium opacity-80 mb-3" id="question-index"></p>
           <p class="text-3xl sm:text-4xl font-extrabold leading-snug" id="current-question">
               è¼‰å…¥ä¸­... è«‹é¸æ“‡ä¸€å€‹ä¸»é¡Œé–‹å§‹éŠæˆ²ï¼
           </p>
       </div>

       <!-- æ§åˆ¶æŒ‰éˆ•å€åŸŸ -->
       <div class="mt-8 w-full flex flex-col sm:flex-row justify-center gap-4">
           <button id="next-button" class="btn-primary bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-xl shadow-md flex-1 text-lg">
               ä¸‹ä¸€é¡Œ (æ›äººå›ç­”)
           </button>
           <button id="reset-button" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-3 px-6 rounded-xl shadow-md text-lg transition duration-150 sm:flex-none">
               é‡æ–°é–‹å§‹æ­¤ä¸»é¡Œ
           </button>
       </div>

       <!-- æ–°å¢æŒ‰éˆ• -->
       <button id="add-question-btn" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-xl shadow-md text-lg transition duration-150">
           + æ–°å¢è‡ªè¨‚é¡Œç›® (æœ¬æ©Ÿå„²å­˜)
       </button>

       <!-- ç‹€æ…‹è¨Šæ¯ -->
       <p id="message" class="mt-6 text-lg text-gray-600 font-medium hidden">
           å¤ªæ£’äº†ï¼é€™å€‹ä¸»é¡Œçš„æ‰€æœ‰é¡Œç›®éƒ½å›ç­”å®Œç•¢å›‰ï¼
       </p>
   </div>
   
   <!-- Modal for Adding Question -->
   <div id="add-question-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden flex items-center justify-center p-4 z-50">
       <div class="bg-white rounded-xl p-6 w-full max-w-md shadow-2xl">
           <h3 class="text-xl font-bold mb-4 text-gray-800">æ–°å¢ä½ çš„å•é¡Œ</h3>
           <textarea id="new-question-input" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 mb-4" placeholder="è¼¸å…¥ä¸€å€‹ä½ æƒ³å•å¤§å®¶çš„å•é¡Œ..."></textarea>
           <div class="flex justify-end gap-3">
               <button id="close-modal-btn" class="px-4 py-2 bg-gray-300 hover:bg-gray-400 rounded-lg text-gray-800 font-semibold">å–æ¶ˆ</button>
               <button id="submit-question-btn" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-lg text-white font-semibold">é€å‡ºé¡Œç›®</button>
           </div>
           <p id="modal-message" class="mt-3 text-sm text-red-500 hidden"></p>
       </div>
   </div>

   <script>
       // æ ¸å¿ƒå•é¡Œè³‡æ–™åº« (ç¡¬ç·¨ç¢¼)
       const HARDCODED_QUESTIONS = {
           'drinking_fun': {
               name: 'ğŸº é…’å±€ç ´å†° (å…§å»º)',
               description: 'é©åˆå¾®é†ºæ™‚çš„çˆ†ç¬‘èˆ‡çœŸå¿ƒè©±ç’°ç¯€ã€‚',
               prompts: [
                   'ä½ æœ€é–‹å¿ƒçš„ä¸€æ¬¡å–é…’ç¶“é©—æ˜¯ä»€éº¼ï¼Ÿ',
                   'ä½ å–é†‰å¾Œåšéæœ€ä¸Ÿè‡‰/æœ€æç¬‘çš„äº‹æƒ…æ˜¯ä»€éº¼ï¼Ÿ',
                   'ä½ è¦ºå¾—èª°çš„é…’é‡æœ€æ·±è—ä¸éœ²ï¼Ÿï¼ˆå¿…é ˆçŒœä¸€ä½åœ¨å ´çš„äººï¼‰',
                   'å½¢å®¹ä¸€ä¸‹ä½ å®¿é†‰æ™‚çš„æ¨£å­ï¼Œä¸¦èªªå‡ºä½ é€™è¼©å­ç™¼èª“å†ä¹Ÿä¸å–çš„é…’ã€‚',
                   'å¦‚æœä½ èƒ½èˆ‡æ­·å²ä¸Šä»»ä½•ä¸€ä½äººç‰©ä¸€èµ·å–é…’ï¼Œä½ æœƒé¸èª°ï¼Ÿå–ä»€éº¼ï¼Ÿ'
               ]
           },
           'family_time': {
               name: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å®¶åº­æ™‚å…‰ (å…§å»º)',
               description: 'æ˜¥ç¯€æˆ–å®¶åº­èšæœƒï¼Œæ‹‰è¿‘å½¼æ­¤è·é›¢çš„æº«é¦¨å•ç­”ã€‚',
               prompts: [
                   'ä½ ç«¥å¹´æ™‚æœ€å–œæ­¡çš„éå¹´æ´»å‹•æ˜¯ä»€éº¼ï¼Ÿ',
                   'ä½ å°å®¶äººèªªéæœ€æ„Ÿå‹•çš„ä¸€å¥è©±æ˜¯ä»€éº¼ï¼Ÿï¼ˆæˆ–æ˜¯è½åˆ°æœ€æ„Ÿå‹•çš„ï¼‰',
                   'å¦‚æœä½ èƒ½äº¤æ›ä¸€å¤©èº«é«”ï¼Œä½ æƒ³æˆç‚ºå®¶è£¡å“ªä¸€ä½æˆå“¡ï¼Ÿç‚ºä»€éº¼ï¼Ÿ',
                   'ä½ å¾å°åˆ°å¤§æœ€å¸¸è¢«å®¶è£¡èª°ç¨±è®šï¼Ÿè¢«ç¨±è®šä»€éº¼ï¼Ÿ',
                   'èªªä¸€ä»¶ä½ å’Œå®¶äººä¸€èµ·å®Œæˆï¼Œè®“ä½ å°è±¡æœ€æ·±åˆ»çš„äº‹æƒ…ã€‚'
               ]
           },
           'deep_thoughts': {
               name: 'ğŸŒŒ æ·±åº¦å°è©± (å…§å»º)',
               description: 'æ¢ç´¢å…§å¿ƒã€ç›®æ¨™èˆ‡å€‹äººæ•…äº‹çš„æ·±åº¦è©±é¡Œã€‚',
               prompts: [
                   'è«‹å„ä½æ‰“é–‹æ‰‹æ©Ÿç…§ç‰‡ï¼ŒæŒ‘é¸ä¸€å¼µä½ è¿‘æœŸæ‹æ”çš„ç…§ç‰‡ï¼Œä¸¦åˆ†äº«é€™å¼µç…§ç‰‡èƒŒå¾Œçš„æ•…äº‹ã€‚',
                   'ä½ è¿‘æœŸåšéæœ€å‹‡æ•¢çš„æ±ºå®šæ˜¯ä»€éº¼ï¼Ÿ',
                   'æœ‰æ²’æœ‰ä»€éº¼æ˜¯ä½ éå»è«®è©¢æˆ‘å€‘çš„æ„è¦‹ï¼Œä½†æœ€å¾Œä½ å …æŒå·±è¦‹çš„ï¼Ÿ',
                   'èªªèªªçœ‹ä½ å°åŠå¹´åŠä¸€å¹´å¾Œæœ‰ä»€éº¼èˆˆå¥®çš„è¦åŠƒåŠè¨ˆç•«ï¼'
               ]
           },
           'custom_user': {
               name: 'ğŸ“ è‡ªè¨‚é¡Œç›® (æœ¬åœ°å„²å­˜)',
               description: 'ç”±ç”¨æˆ¶åœ¨æœ¬æ©Ÿæ–°å¢çš„é¡Œç›®ï¼Œä¸èˆ‡ä»–äººåŒæ­¥ã€‚',
               prompts: [] // å°‡ç”± localStorage å¡«å……
           }
       };

       let ALL_QUESTIONS = { ...HARDCODED_QUESTIONS }; // å¯è®Šå‹•çš„é¡Œåº«

       // DOM å…ƒç´ åƒè€ƒ
       const categorySelect = document.getElementById('category-select');
       const currentQuestionEl = document.getElementById('current-question');
       const questionIndexEl = document.getElementById('question-index');
       const nextButton = document.getElementById('next-button');
       const resetButton = document.getElementById('reset-button');
       const messageEl = document.getElementById('message');
       const questionCard = document.getElementById('question-card');
       
       const addQuestionModal = document.getElementById('add-question-modal');
       const closeModalBtn = document.getElementById('close-modal-btn');
       const submitQuestionBtn = document.getElementById('submit-question-btn');
       const newQuestionInput = document.getElementById('new-question-input');
       const modalMessage = document.getElementById('modal-message');

       let currentCategoryKey = '';
       let currentIndex = 0;

       // --- æœ¬åœ°å„²å­˜é‚è¼¯ ---
       
       function loadCustomQuestions() {
           const custom = localStorage.getItem('localCustomQuestions');
           try {
               // å˜—è©¦è§£æ JSONï¼Œå¦‚æœè§£æå¤±æ•—å‰‡è¿”å›ç©ºé™£åˆ—
               return custom ? JSON.parse(custom) : [];
           } catch (e) {
               console.error("Error parsing local questions:", e);
               return [];
           }
       }

       function saveQuestionLocally(promptText) {
           const customPrompts = loadCustomQuestions();
           customPrompts.push(promptText);
           // å°‡æ›´æ–°å¾Œçš„é™£åˆ—å­˜å› localStorage
           localStorage.setItem('localCustomQuestions', JSON.stringify(customPrompts));
           
           // ç«‹å³æ›´æ–°è¨˜æ†¶é«”ä¸­çš„é¡Œåº«
           ALL_QUESTIONS['custom_user'].prompts = customPrompts;

           // å¦‚æœç•¶å‰é¸ä¸­è‡ªè¨‚é¡Œç›®ï¼Œå‰‡åˆ·æ–°é¡¯ç¤º
           if (currentCategoryKey === 'custom_user') {
               displayQuestion();
           }
       }

       // --- æ ¸å¿ƒ App é‚è¼¯ (ç„¡ Firebase) ---
       
       function loadApp() {
           // 1. è¼‰å…¥æœ¬åœ°å„²å­˜çš„è‡ªè¨‚é¡Œç›®
           ALL_QUESTIONS['custom_user'].prompts = loadCustomQuestions();

           // 2. åˆå§‹åŒ–åˆ†é¡é¸å–®
           initializeCategories();
           
           // 3. è¼‰å…¥ä¸Šæ¬¡çš„é€²åº¦
           loadState();
       }

       // åˆå§‹åŒ–ï¼šè¼‰å…¥é¡åˆ¥é¸é …
       function initializeCategories() {
           for (const key in ALL_QUESTIONS) {
               const option = document.createElement('option');
               option.value = key;
               option.textContent = ALL_QUESTIONS[key].name;
               categorySelect.appendChild(option);
           }
       }

       // å¾ localStorage è¼‰å…¥ç›®å‰çš„é€²åº¦ç‹€æ…‹
       function loadState() {
           const savedCategory = localStorage.getItem('conversationStarterCategory');
           const savedIndex = localStorage.getItem('conversationStarterIndex');

           if (savedCategory && ALL_QUESTIONS[savedCategory]) {
               currentCategoryKey = savedCategory;
               currentIndex = parseInt(savedIndex) || 0;
           } else {
               // é è¨­é¸æ“‡ç¬¬ä¸€å€‹é¡åˆ¥
               currentCategoryKey = Object.keys(ALL_QUESTIONS)[0];
               currentIndex = 0;
           }
           categorySelect.value = currentCategoryKey;
           displayQuestion();
       }

       // å°‡ç›®å‰çš„ç‹€æ…‹å„²å­˜åˆ° localStorage
       function saveState() {
           localStorage.setItem('conversationStarterCategory', currentCategoryKey);
           localStorage.setItem('conversationStarterIndex', currentIndex.toString());
       }

       // é¡¯ç¤ºç•¶å‰å•é¡Œ
       function displayQuestion() {
           const currentPrompts = ALL_QUESTIONS[currentCategoryKey].prompts;
           messageEl.classList.add('hidden');
           nextButton.disabled = false;
           resetButton.disabled = false;
           questionCard.classList.remove('bg-gray-400');
           questionCard.classList.add('bg-indigo-500');

           if (currentPrompts.length === 0 && currentCategoryKey === 'custom_user') {
               currentQuestionEl.textContent = `è«‹é»æ“Šã€Œ+ æ–°å¢è‡ªè¨‚é¡Œç›® (æœ¬æ©Ÿå„²å­˜)ã€æŒ‰éˆ•ï¼Œç‚ºã€Œ${ALL_QUESTIONS[currentCategoryKey].name}ã€æ·»åŠ ç¬¬ä¸€å€‹å•é¡Œï¼`;
               questionIndexEl.textContent = 'ç›®å‰æ²’æœ‰é¡Œç›®';
               nextButton.disabled = true;
               return;
           }
           
           if (currentIndex >= currentPrompts.length) {
               // é¡Œç›®å·²å…¨éƒ¨é¡¯ç¤ºå®Œç•¢
               currentQuestionEl.textContent = `ğŸ‰ ä¸»é¡Œ ${ALL_QUESTIONS[currentCategoryKey].name} æŒ‘æˆ°æˆåŠŸï¼`;
               questionIndexEl.textContent = 'å·²å›ç­”æ‰€æœ‰å•é¡Œ';
               messageEl.textContent = `å¤ªæ£’äº†ï¼é€™å€‹ä¸»é¡Œçš„æ‰€æœ‰ ${currentPrompts.length} å€‹é¡Œç›®éƒ½å›ç­”å®Œç•¢å›‰ï¼æŒ‰ã€Œé‡æ–°é–‹å§‹ã€å¯ä»¥å†ç©ä¸€æ¬¡ï¼`;
               messageEl.classList.remove('hidden');
               nextButton.disabled = true;
               questionCard.classList.remove('bg-indigo-500');
               questionCard.classList.add('bg-gray-400');
               saveState();
           } else {
               // é¡¯ç¤ºç•¶å‰é¡Œç›®
               const questionNumber = currentIndex + 1;
               currentQuestionEl.textContent = currentPrompts[currentIndex];
               questionIndexEl.textContent = `ç¬¬ ${questionNumber} / ${currentPrompts.length} é¡Œ`;
               saveState();
           }
       }

       // æ›ä¸‹ä¸€é¡Œ
       function nextQuestion() {
           const currentPrompts = ALL_QUESTIONS[currentCategoryKey].prompts;
           if (currentIndex < currentPrompts.length) {
               currentIndex++;
               displayQuestion();
           }
       }

       // é‡è¨­ç›®å‰ä¸»é¡Œçš„é€²åº¦
       function resetCategory() {
           currentIndex = 0;
           displayQuestion();
           currentQuestionEl.textContent = `âœ… ä¸»é¡Œã€Œ${ALL_QUESTIONS[currentCategoryKey].name}ã€å·²é‡è¨­ï¼é»æ“Šã€Œä¸‹ä¸€é¡Œã€é–‹å§‹ã€‚`;
           questionIndexEl.textContent = 'æº–å‚™é–‹å§‹...';
           nextButton.disabled = false;
           messageEl.classList.add('hidden');
       }

       // --- Modal äº‹ä»¶è™•ç† (ä½¿ç”¨æœ¬åœ°å„²å­˜) ---
       
       function handleSubmitQuestion() {
           const prompt = newQuestionInput.value.trim();
           if (prompt.length < 5) {
               modalMessage.textContent = 'é¡Œç›®å…§å®¹å¤ªçŸ­ï¼Œè«‹è¼¸å…¥è‡³å°‘ 5 å€‹å­—ã€‚';
               modalMessage.classList.remove('hidden');
               return;
           }
           
           submitQuestionBtn.textContent = 'å„²å­˜ä¸­...';
           submitQuestionBtn.disabled = true;

           // å„²å­˜åˆ°æœ¬åœ°
           saveQuestionLocally(prompt);
           
           newQuestionInput.value = '';
           modalMessage.textContent = 'é¡Œç›®æ–°å¢æˆåŠŸï¼å·²å„²å­˜åˆ°ã€Œè‡ªè¨‚é¡Œç›® (æœ¬åœ°å„²å­˜)ã€é¡åˆ¥ã€‚';
           modalMessage.classList.remove('hidden');
           
           setTimeout(() => {
               addQuestionModal.classList.add('hidden');
               submitQuestionBtn.textContent = 'é€å‡ºé¡Œç›®';
               submitQuestionBtn.disabled = false;
           }, 1500);
       }


       // --- äº‹ä»¶ç›£è½å™¨ ---

       categorySelect.addEventListener('change', (event) => {
           currentCategoryKey = event.target.value;
           currentIndex = 0;
           displayQuestion();
       });

       nextButton.addEventListener('click', nextQuestion);
       resetButton.addEventListener('click', resetCategory);

       document.getElementById('add-question-btn').addEventListener('click', () => {
           addQuestionModal.classList.remove('hidden');
           newQuestionInput.value = '';
           modalMessage.classList.add('hidden');
       });

       closeModalBtn.addEventListener('click', () => {
           addQuestionModal.classList.add('hidden');
       });

       submitQuestionBtn.addEventListener('click', handleSubmitQuestion);


       // æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•
       window.onload = function() {
           loadApp(); // å•Ÿå‹• App
       };
   </script>
</body>
</html>